

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Structured Final Response Pattern &mdash; AI Agent Framework 2.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=b21de401"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Model Optimization Strategy" href="model_optimization_strategy.html" />
    <link rel="prev" title="Phoenix Tracing (Arize)" href="phoenix_tracing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            AI Agent Framework
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Domain Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../powerbi/index.html">Power BI Domain Example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional Resources</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../framework_guide.html">Framework Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">AI Agent Framework (Overview)</a></li>
<li class="toctree-l1"><a class="reference internal" href="library_architecture.html">Library Architecture</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Structured Final Response Pattern</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-problem">The Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-solution">The Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#framework-type-definition">Framework Type Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-agents-return-finalresponse">How Agents Return FinalResponse</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#from-planner-s-plan-method">1. From Planner’s <code class="docutils literal notranslate"><span class="pre">plan()</span></code> Method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#from-reactplanner-llm-output">2. From ReActPlanner LLM Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="#from-agent-s-run-method">3. From Agent’s <code class="docutils literal notranslate"><span class="pre">run()</span></code> Method</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#event-publishing">Event Publishing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#common-operation-types">Common Operation Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#display-message">1. <code class="docutils literal notranslate"><span class="pre">display_message</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#display-table">2. <code class="docutils literal notranslate"><span class="pre">display_table</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#display-data">3. <code class="docutils literal notranslate"><span class="pre">display_data</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#application-specific-operations">4. Application-Specific Operations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#integration-with-application">Integration with Application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#receiving-finalresponse">Receiving FinalResponse</a></li>
<li class="toctree-l3"><a class="reference internal" href="#handling-different-operations">Handling Different Operations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#prompt-engineering">Prompt Engineering</a></li>
<li class="toctree-l2"><a class="reference internal" href="#backward-compatibility">Backward Compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="#benefits">Benefits</a></li>
<li class="toctree-l2"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="runtime_loop_stagnation.html">Runtime Loop &amp; Stagnation</a></li>
<li class="toctree-l1"><a class="reference internal" href="observability.html">Observability</a></li>
<li class="toctree-l1"><a class="reference internal" href="message_store_integration.html">Message Store Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="message_store_format.html">Message Store Format Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="message_store_implementation.html">Message Store Implementation Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AI Agent Framework</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Guides</a></li>
      <li class="breadcrumb-item active">Structured Final Response Pattern</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guides/structured_final_response.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="structured-final-response-pattern">
<h1>Structured Final Response Pattern<a class="headerlink" href="#structured-final-response-pattern" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The <strong>Structured Final Response</strong> pattern enables agents to return machine-readable, actionable data instead of simple text strings. This pattern solves the problem of passing structured data from the agent’s reasoning loop to external systems (like frontends) without fragile string parsing.</p>
</section>
<section id="the-problem">
<h2>The Problem<a class="headerlink" href="#the-problem" title="Link to this heading"></a></h2>
<p>Without structured responses, agents return simple text:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;I have successfully completed the task.&quot;</span>
</pre></div>
</div>
<p>This is fine for chat logs but:</p>
<ul class="simple">
<li><p>❌ Not machine-readable</p></li>
<li><p>❌ Requires brittle string parsing</p></li>
<li><p>❌ No clear contract between agent and application</p></li>
<li><p>❌ Difficult to trigger specific UI behaviors</p></li>
</ul>
</section>
<section id="the-solution">
<h2>The Solution<a class="headerlink" href="#the-solution" title="Link to this heading"></a></h2>
<p>The framework provides a <code class="docutils literal notranslate"><span class="pre">FinalResponse</span></code> class that agents can return with:</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">operation</span></code></strong>: High-level command for the application (e.g., “display_message”, “display_table”)</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">payload</span></code></strong>: JSON data to execute the operation</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">human_readable_summary</span></code></strong>: Natural language text for chat display</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">agent_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">FinalResponse</span>

<span class="n">FinalResponse</span><span class="p">(</span>
    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;display_table&quot;</span><span class="p">,</span>
    <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Results&quot;</span><span class="p">,</span>
        <span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Column 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Column 2&quot;</span><span class="p">],</span>
        <span class="s2">&quot;rows&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="s2">&quot;Value 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Value 2&quot;</span><span class="p">]]</span>
    <span class="p">},</span>
    <span class="n">human_readable_summary</span><span class="o">=</span><span class="s2">&quot;Found 1 result matching your query.&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="framework-type-definition">
<h2>Framework Type Definition<a class="headerlink" href="#framework-type-definition" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">FinalResponse</span></code> class is defined in <code class="docutils literal notranslate"><span class="pre">agent_framework.base</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>

<span class="k">class</span><span class="w"> </span><span class="nc">FinalResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a final, structured response to the user or application.</span>
<span class="sd">    </span>
<span class="sd">    This is returned when the agent has completed its task and needs to communicate</span>
<span class="sd">    the result in a machine-readable format for frontend consumption.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span> 
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The high-level operation the frontend should perform (e.g., &#39;display_message&#39;, &#39;update_file_tree&#39;, &#39;display_table&#39;).&quot;</span>
    <span class="p">)</span>
    <span class="n">payload</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span> 
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A JSON object containing the data needed to execute the operation.&quot;</span>
    <span class="p">)</span>
    <span class="n">human_readable_summary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span> 
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A natural language summary of the result for display in a chat log.&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="how-agents-return-finalresponse">
<h2>How Agents Return FinalResponse<a class="headerlink" href="#how-agents-return-finalresponse" title="Link to this heading"></a></h2>
<section id="from-planner-s-plan-method">
<h3>1. From Planner’s <code class="docutils literal notranslate"><span class="pre">plan()</span></code> Method<a class="headerlink" href="#from-planner-s-plan-method" title="Link to this heading"></a></h3>
<p>Planners can return <code class="docutils literal notranslate"><span class="pre">FinalResponse</span></code> directly from their <code class="docutils literal notranslate"><span class="pre">plan()</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">agent_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">BasePlanner</span><span class="p">,</span> <span class="n">FinalResponse</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyPlanner</span><span class="p">(</span><span class="n">BasePlanner</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">plan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Action</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Action</span><span class="p">],</span> <span class="n">FinalResponse</span><span class="p">]:</span>
        <span class="c1"># ... reasoning ...</span>
        
        <span class="k">if</span> <span class="n">task_complete</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FinalResponse</span><span class="p">(</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;display_message&quot;</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Task completed successfully.&quot;</span><span class="p">},</span>
                <span class="n">human_readable_summary</span><span class="o">=</span><span class="s2">&quot;Task completed successfully.&quot;</span>
            <span class="p">)</span>
        
        <span class="c1"># Otherwise return Action(s)</span>
        <span class="k">return</span> <span class="n">Action</span><span class="p">(</span><span class="n">tool_name</span><span class="o">=</span><span class="s2">&quot;some_tool&quot;</span><span class="p">,</span> <span class="n">tool_args</span><span class="o">=</span><span class="p">{</span><span class="o">...</span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="from-reactplanner-llm-output">
<h3>2. From ReActPlanner LLM Output<a class="headerlink" href="#from-reactplanner-llm-output" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">ReActPlanner</span></code> can parse structured <code class="docutils literal notranslate"><span class="pre">final_response</span></code> from LLM JSON output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># LLM returns JSON like:</span>
<span class="p">{</span>
    <span class="s2">&quot;thought&quot;</span><span class="p">:</span> <span class="s2">&quot;I have completed the task...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;final_response&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;operation&quot;</span><span class="p">:</span> <span class="s2">&quot;display_table&quot;</span><span class="p">,</span>
        <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">],</span>
            <span class="s2">&quot;rows&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="s2">&quot;Item 1&quot;</span><span class="p">,</span> <span class="s2">&quot;100&quot;</span><span class="p">]]</span>
        <span class="p">},</span>
        <span class="s2">&quot;human_readable_summary&quot;</span><span class="p">:</span> <span class="s2">&quot;Found 1 item.&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># ReActPlanner automatically converts this to FinalResponse</span>
</pre></div>
</div>
<p>The planner supports both:</p>
<ul class="simple">
<li><p><strong>New format</strong>: <code class="docutils literal notranslate"><span class="pre">{&quot;final_response&quot;:</span> <span class="pre">{...}}</span></code></p></li>
<li><p><strong>Legacy format</strong>: <code class="docutils literal notranslate"><span class="pre">{&quot;final_answer&quot;:</span> <span class="pre">&quot;...&quot;}</span></code> (automatically converted to <code class="docutils literal notranslate"><span class="pre">FinalResponse</span></code>)</p></li>
</ul>
</section>
<section id="from-agent-s-run-method">
<h3>3. From Agent’s <code class="docutils literal notranslate"><span class="pre">run()</span></code> Method<a class="headerlink" href="#from-agent-s-run-method" title="Link to this heading"></a></h3>
<p>Agents return <code class="docutils literal notranslate"><span class="pre">FinalResponse</span></code> directly from <code class="docutils literal notranslate"><span class="pre">run()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">agent_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;Your task here&quot;</span><span class="p">)</span>

<span class="c1"># result is a FinalResponse object</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">operation</span><span class="p">)</span>  <span class="c1"># e.g., &quot;display_message&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>    <span class="c1"># Dict with operation data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">human_readable_summary</span><span class="p">)</span>  <span class="c1"># Human-readable text</span>
</pre></div>
</div>
</section>
</section>
<section id="event-publishing">
<h2>Event Publishing<a class="headerlink" href="#event-publishing" title="Link to this heading"></a></h2>
<p>When an agent returns a <code class="docutils literal notranslate"><span class="pre">FinalResponse</span></code>, the framework automatically publishes an <code class="docutils literal notranslate"><span class="pre">agent_end</span></code> event with the structured data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Framework automatically does this:</span>
<span class="n">event_bus</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s2">&quot;agent_end&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">final_response</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span>
    <span class="s2">&quot;operation&quot;</span><span class="p">:</span> <span class="n">final_response</span><span class="o">.</span><span class="n">operation</span><span class="p">,</span>
    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">final_response</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span>
    <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="n">final_response</span><span class="o">.</span><span class="n">human_readable_summary</span>
<span class="p">})</span>
</pre></div>
</div>
</section>
<section id="common-operation-types">
<h2>Common Operation Types<a class="headerlink" href="#common-operation-types" title="Link to this heading"></a></h2>
<p>The framework doesn’t prescribe specific operation types - you define them based on your application’s needs. Common patterns include:</p>
<section id="display-message">
<h3>1. <code class="docutils literal notranslate"><span class="pre">display_message</span></code><a class="headerlink" href="#display-message" title="Link to this heading"></a></h3>
<p>Simple text responses.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">FinalResponse</span><span class="p">(</span>
    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;display_message&quot;</span><span class="p">,</span>
    <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Task completed successfully.&quot;</span><span class="p">},</span>
    <span class="n">human_readable_summary</span><span class="o">=</span><span class="s2">&quot;Task completed successfully.&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="display-table">
<h3>2. <code class="docutils literal notranslate"><span class="pre">display_table</span></code><a class="headerlink" href="#display-table" title="Link to this heading"></a></h3>
<p>Structured tabular data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">FinalResponse</span><span class="p">(</span>
    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;display_table&quot;</span><span class="p">,</span>
    <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Query Results&quot;</span><span class="p">,</span>
        <span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Column 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Column 2&quot;</span><span class="p">],</span>
        <span class="s2">&quot;rows&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;Row 1 Col 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Row 1 Col 2&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;Row 2 Col 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Row 2 Col 2&quot;</span><span class="p">]</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="n">human_readable_summary</span><span class="o">=</span><span class="s2">&quot;Found 2 results.&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="display-data">
<h3>3. <code class="docutils literal notranslate"><span class="pre">display_data</span></code><a class="headerlink" href="#display-data" title="Link to this heading"></a></h3>
<p>Structured JSON data (lists, objects, etc.).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">FinalResponse</span><span class="p">(</span>
    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;display_data&quot;</span><span class="p">,</span>
    <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Item 1&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Item 2&quot;</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="n">human_readable_summary</span><span class="o">=</span><span class="s2">&quot;Retrieved 2 items.&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="application-specific-operations">
<h3>4. Application-Specific Operations<a class="headerlink" href="#application-specific-operations" title="Link to this heading"></a></h3>
<p>Your implementation can define any operation types you need:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example: File operations</span>
<span class="n">FinalResponse</span><span class="p">(</span>
    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;update_file_tree&quot;</span><span class="p">,</span>
    <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;changed_files&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;path/to/file1&quot;</span><span class="p">,</span> <span class="s2">&quot;path/to/file2&quot;</span><span class="p">],</span>
        <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Modified 2 files&quot;</span>
    <span class="p">},</span>
    <span class="n">human_readable_summary</span><span class="o">=</span><span class="s2">&quot;Successfully updated files.&quot;</span>
<span class="p">)</span>

<span class="c1"># Example: Custom UI operations</span>
<span class="n">FinalResponse</span><span class="p">(</span>
    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;show_visualization&quot;</span><span class="p">,</span>
    <span class="n">payload</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;chart_type&quot;</span><span class="p">:</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="n">human_readable_summary</span><span class="o">=</span><span class="s2">&quot;Displaying chart visualization.&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="integration-with-application">
<h2>Integration with Application<a class="headerlink" href="#integration-with-application" title="Link to this heading"></a></h2>
<section id="receiving-finalresponse">
<h3>Receiving FinalResponse<a class="headerlink" href="#receiving-finalresponse" title="Link to this heading"></a></h3>
<p>Applications can receive <code class="docutils literal notranslate"><span class="pre">FinalResponse</span></code> objects and handle them based on operation type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example: FastAPI endpoint</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agent_framework</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">FinalResponse</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/run&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_agent</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>  <span class="c1"># Returns FinalResponse</span>
    
    <span class="c1"># Return structured response to frontend</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;operation&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">operation</span><span class="p">,</span>
        <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">human_readable_summary</span>
    <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="handling-different-operations">
<h3>Handling Different Operations<a class="headerlink" href="#handling-different-operations" title="Link to this heading"></a></h3>
<p>Applications can route based on operation type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;display_table&quot;</span><span class="p">:</span>
    <span class="c1"># Render table UI component</span>
    <span class="n">render_table</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;display_message&quot;</span><span class="p">:</span>
    <span class="c1"># Show simple message</span>
    <span class="n">show_message</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">human_readable_summary</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;display_data&quot;</span><span class="p">:</span>
    <span class="c1"># Render structured data</span>
    <span class="n">render_data</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Unknown operation - fallback to summary</span>
    <span class="n">show_message</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">human_readable_summary</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="prompt-engineering">
<h2>Prompt Engineering<a class="headerlink" href="#prompt-engineering" title="Link to this heading"></a></h2>
<p>To instruct LLMs to return structured responses, include this in your planner’s system prompt:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">system_prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">...</span>
<span class="s2">When your task is complete, return a JSON response with a &quot;final_response&quot; key:</span>

<span class="s2">{</span>
<span class="s2">    &quot;thought&quot;: &quot;I have completed the task...&quot;,</span>
<span class="s2">    &quot;final_response&quot;: {</span>
<span class="s2">        &quot;operation&quot;: &quot;&lt;operation_type&gt;&quot;,</span>
<span class="s2">        &quot;payload&quot;: { ...data... },</span>
<span class="s2">        &quot;human_readable_summary&quot;: &quot;Natural language summary&quot;</span>
<span class="s2">    }</span>
<span class="s2">}</span>

<span class="s2">Common operation types:</span>
<span class="s2">- display_message: Simple text response</span>
<span class="s2">- display_table: Tabular data with headers and rows</span>
<span class="s2">- display_data: Structured JSON data</span>
<span class="s2">- [Add your custom operation types here]</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</section>
<section id="backward-compatibility">
<h2>Backward Compatibility<a class="headerlink" href="#backward-compatibility" title="Link to this heading"></a></h2>
<p>The framework maintains backward compatibility with legacy string responses:</p>
<ol class="arabic simple">
<li><p><strong>Legacy format support</strong>: Planners can still return <code class="docutils literal notranslate"><span class="pre">{&quot;final_answer&quot;:</span> <span class="pre">&quot;...&quot;}</span></code> which is automatically converted to <code class="docutils literal notranslate"><span class="pre">FinalResponse</span></code></p></li>
<li><p><strong>Fallback behavior</strong>: If no structured response is provided, the framework creates a default <code class="docutils literal notranslate"><span class="pre">FinalResponse</span></code> with <code class="docutils literal notranslate"><span class="pre">operation=&quot;display_message&quot;</span></code></p></li>
</ol>
</section>
<section id="benefits">
<h2>Benefits<a class="headerlink" href="#benefits" title="Link to this heading"></a></h2>
<p>✅ <strong>Type Safety</strong>: Pydantic validation ensures the contract is enforced<br />
✅ <strong>Decoupling</strong>: Agent doesn’t need to know about application UI details<br />
✅ <strong>Extensibility</strong>: Add new operation types without framework changes<br />
✅ <strong>Machine-Readable</strong>: Structured data that applications can process<br />
✅ <strong>Human-Friendly</strong>: Always includes natural language summary for display</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">FinalResponse</span></code> pattern transforms agent outputs from “strings to parse” into “commands to execute”, making the entire system more reliable, maintainable, and extensible. Applications can handle different operation types programmatically while still providing human-readable summaries for chat logs.</p>
<p>This is a framework capability that implementations can leverage to create rich, interactive agent experiences.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="phoenix_tracing.html" class="btn btn-neutral float-left" title="Phoenix Tracing (Arize)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="model_optimization_strategy.html" class="btn btn-neutral float-right" title="Model Optimization Strategy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Project Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>