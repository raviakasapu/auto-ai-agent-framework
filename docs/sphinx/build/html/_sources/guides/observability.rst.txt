Observability
=============

Event Bus
---------

- Module: ``agent_framework/core/events.py``
- ``EventBus`` delivers internal lifecycle events to subscribers.
- Built‑in ``LoggingSubscriber`` prints structured events with a configurable
  level and optional payload truncation.

Subscribers
-----------

- ``LoggingSubscriber`` — configure via YAML or code with ``level``,
  ``include_data``, ``max_payload_chars``, and per‑event overrides
  (``event_levels``).
- ``LangfuseSubscriber`` — emits events to Langfuse (requires ``langfuse``
  package and ``LANGFUSE_PUBLIC_KEY/SECRET_KEY``).
- ``PhoenixSubscriber`` — exports spans via OpenTelemetry OTLP HTTP for Arize
  Phoenix (requires ``opentelemetry`` packages).

YAML Configuration
------------------

.. code-block:: yaml

   apiVersion: agent.framework/v1
   kind: Agent
   metadata:
     name: sample
   resources:
     subscribers:
       - name: logs
         type: LoggingSubscriber
         config:
           level: INFO
           include_data: true
       - name: langfuse-tracker
         type: LangfuseSubscriber
         config:
           host: ${LANGFUSE_HOST}
           public_key: ${LANGFUSE_PUBLIC_KEY}
           secret_key: ${LANGFUSE_SECRET_KEY}
   spec:
     subscribers: [logs, langfuse-tracker]

Environment & Logging
---------------------

- Global level: set ``AGENT_LOG_LEVEL`` (default ``INFO``)
- Format: set ``AGENT_LOG_FORMAT`` for custom logging format
- Router debug: set ``AGENT_LOG_ROUTER_DETAILS=true`` or planner ``log_details: true``
- Streaming filters: override ``FRONTEND_EVENT_ALLOWLIST`` (comma-delimited) to select events for UI updates. The default allowlist lives in ``agent_framework.progress_filters``.
